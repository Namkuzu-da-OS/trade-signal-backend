<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Trading Signals | Multi-Timeframe Scanner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse-dot {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .pulse-dot {
            animation: pulse-dot 2s ease-in-out infinite;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-10px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        .signal-STRONG_BUY {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .signal-BUY {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        .signal-WATCH {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .signal-HOLD {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        }

        .timeframe-pill {
            @apply inline-block px-2 py-1 rounded text-xs font-medium;
        }

        .tf-high {
            @apply bg-green-900/40 text-green-300 border border-green-800;
        }

        .tf-medium {
            @apply bg-blue-900/40 text-blue-300 border border-blue-800;
        }

        .tf-low {
            @apply bg-gray-800 text-gray-400 border border-gray-700;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }

        .font-mono-nums {
            font-feature-settings: "tnum";
            font-variant-numeric: tabular-nums;
        }

        </head><body class="bg-gray-950 text-gray-100">< !-- Navigation Tabs --><nav class="bg-gray-900 border-b border-gray-800 sticky top-0 z-50 shadow-sm"><div class="container mx-auto px-4"><div class="flex gap-1"><a href="/index.html"
        class="px-6 py-4 text-sm font-semibold text-gray-400 hover:text-white hover:bg-gray-800 transition">üìä Main Dashboard </a><a href="/signals.html"
        class="px-6 py-4 text-sm font-semibold bg-gray-800 border-b-2 border-blue-500 text-white">üéØ Live Signals </a></div></div></nav>< !-- Market Ticker --><div class="bg-gray-900 border-b border-gray-800 py-2"><div class="container mx-auto px-4 flex justify-between items-center text-sm overflow-x-auto" id="marketTicker"><span class="text-gray-500 animate-pulse">Loading market data...</span></div></div><div class="container mx-auto px-4 py-8 max-w-7xl">< !-- Header --><div class="bg-gray-900 rounded-lg shadow-lg border border-gray-800 p-6 mb-6"><div class="flex items-center justify-between"><div><h1 class="text-3xl font-bold text-white flex items-center gap-3">üéØ Live Trading Signals <span id="statusIndicator"
        class="text-sm font-normal px-3 py-1 rounded-full bg-gray-800 text-gray-400">Scanner: Stopped </span></h1><p class="text-gray-400 mt-1">Multi-Timeframe Analysis | Auto-Refresh: <span id="refreshTimer">30s</span></p></div><div class="flex gap-3"><div class="flex gap-3"><button id="manualScanBtn"
        class="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg shadow transition">‚ö° Manual Scan </button><button id="startBtn"
        class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow transition">‚ñ∂ Start Auto-Scanner </button><button id="stopBtn"
        class="px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg shadow transition">‚èπ Stop </button><button id="refreshBtn"
        class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow transition">üîÑ Refresh </button></div></div></div>< !-- Scanner Status Details --><div id="scannerDetails" class="mt-4 grid grid-cols-4 gap-4 pt-4 border-t border-gray-800 hidden"><div><p class="text-sm text-gray-500">Scan Interval</p><p class="text-lg font-semibold text-gray-200" id="scanInterval">-</p></div><div><p class="text-sm text-gray-500">Watchlist Symbols</p><p class="text-lg font-semibold text-gray-200" id="watchlistCount">-</p></div><div><p class="text-sm text-gray-500">Last Scan</p><p class="text-lg font-semibold text-gray-200" id="lastScan">-</p></div><div><p class="text-sm text-gray-500">Next Scan In</p><p class="text-lg font-semibold text-gray-200" id="nextScan">-</p></div></div>< !-- Activity Console (Collapsed by default) --><div class="mt-4 pt-4 border-t border-gray-800"><button id="consoleToggleBtn"
        class="flex items-center gap-2 text-xs font-semibold text-gray-400 hover:text-white transition"><span id="consoleToggleIcon">‚ñ∂</span>Show Activity Log </button><div id="activityConsole"
        class="mt-2 bg-gray-950 rounded border border-gray-800 p-3 font-mono text-xs max-h-40 overflow-y-auto hidden"><div id="consoleContent" class="space-y-1"><div class="text-gray-600">Waiting for activity...</div></div></div></div></div>< !-- View Controls --><div class="flex justify-between items-center mb-4"><div class="flex gap-2"><button id="viewTableBtn" class="px-3 py-1.5 text-sm font-medium bg-gray-800 text-white rounded border border-gray-700 hover:bg-gray-700 active">List View </button><button id="viewHeatmapBtn" class="px-3 py-1.5 text-sm font-medium bg-gray-900 text-gray-400 rounded border border-gray-800 hover:bg-gray-800 hover:text-white">Heatmap </button></div><div class="flex gap-2"><select id="filterSignal" class="bg-gray-900 border border-gray-700 text-gray-300 text-sm rounded px-3 py-1.5 focus:ring-indigo-500 focus:border-indigo-500"><option value="ALL">All Signals</option><option value="BUY">Buys Only</option><option value="SELL">Sells Only</option><option value="STRONG">Strong Only</option></select></div></div>< !-- Heatmap View (Hidden by default) --><div id="heatmapView" class="hidden grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6">< !-- Populated by JS --></div>< !-- Signals Table --><div class="bg-gray-900 rounded-lg shadow-lg border border-gray-800 overflow-hidden"><div class="overflow-x-auto"><table class="w-full"><thead class="bg-gray-800 text-gray-200"><tr><th class="px-4 py-3 text-left text-xs font-bold text-gray-400 uppercase tracking-wider">Symbol</th><th class="px-4 py-3 text-left text-xs font-bold text-gray-400 uppercase tracking-wider">Signal</th><th class="px-4 py-3 text-center text-xs font-bold text-gray-400 uppercase tracking-wider">Score</th><th class="px-4 py-3 text-center text-xs font-bold text-gray-400 uppercase tracking-wider">Timeframes</th><th class="px-4 py-3 text-right text-xs font-bold text-gray-400 uppercase tracking-wider">Entry</th><th class="px-4 py-3 text-right text-xs font-bold text-gray-400 uppercase tracking-wider">Stop</th><th class="px-4 py-3 text-right text-xs font-bold text-gray-400 uppercase tracking-wider">Target</th><th class="px-4 py-3 text-center text-xs font-bold text-gray-400 uppercase tracking-wider">Updated</th><th class="px-4 py-3 text-center text-xs font-bold text-gray-400 uppercase tracking-wider">Actions</th></tr></thead><tbody id="signalsTable" class="divide-y divide-gray-800"><tr><td colspan="8" class="px-6 py-12 text-center text-gray-500"><div class="flex flex-col items-center gap-3"><svg class="w-16 h-16 text-gray-700" fill="none" stroke="currentColor"
        viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg><p class="text-lg font-medium text-gray-400">No signals yet</p><p class="text-sm text-gray-500">Start the scanner to begin analyzing your watchlist </p></div></td></tr></tbody></table></div></div>< !-- Legend --><div class="mt-6 bg-gray-900 rounded-lg shadow border border-gray-800 p-6"><h3 class="text-sm font-semibold text-gray-300 mb-3">Signal Legend</h3><div class="grid grid-cols-2 md:grid-cols-4 gap-4"><div class="flex items-center gap-2"><div class="w-4 h-4 rounded-full bg-green-500"></div><span class="text-sm text-gray-400">STRONG BUY (85%+, 3/3 timeframes bullish)</span></div><div class="flex items-center gap-2"><div class="w-4 h-4 rounded-full bg-blue-500"></div><span class="text-sm text-gray-400">BUY (70%+, 2/3 timeframes bullish)</span></div><div class="flex items-center gap-2"><div class="w-4 h-4 rounded-full bg-yellow-500"></div><span class="text-sm text-gray-400">WATCH (40%+, mixed signals)</span></div><div class="flex items-center gap-2"><div class="w-4 h-4 rounded-full bg-gray-500"></div><span class="text-sm text-gray-400">HOLD (<40%, no clear direction)</span></div></div></div></div>< !-- Expanded Details Modal --><div id="detailsModal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50"><div class="bg-gray-900 border border-gray-800 rounded-lg shadow-2xl max-w-2xl w-full m-4 max-h-[90vh] overflow-y-auto"><div class="p-6"><div class="flex items-center justify-between mb-6"><h2 class="text-2xl font-bold" id="modalSymbol">-</h2><button id="modalCloseBtn" class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M6 18L18 6M6 6l12 12"></path></svg></button></div><div id="modalContent" class="space-y-4">< !-- Content populated by JS --></div></div></div></div><script>let refreshInterval;
        let countdownInterval;
        let refreshCountdown=30;

        // Initialize
        document.addEventListener('DOMContentLoaded', ()=> {
                checkScannerStatus();
                refreshSignals();
                startRefreshCountdown();
                fetchActivityLogs(); // Initial log fetch
                fetchMarketStatus(); // Initial market fetch
                setInterval(fetchActivityLogs, 3000); // Update logs every 3 seconds
                setInterval(fetchMarketStatus, 60000); // Update market every minute

                // Event Listeners
                document.getElementById('manualScanBtn').addEventListener('click', manualScan);
                document.getElementById('startBtn').addEventListener('click', startScanner);
                document.getElementById('stopBtn').addEventListener('click', stopScanner);
                document.getElementById('refreshBtn').addEventListener('click', refreshSignals);
                document.getElementById('consoleToggleBtn').addEventListener('click', toggleConsole);
                document.getElementById('modalCloseBtn').addEventListener('click', closeModal);

                // Event delegation for table rows
                document.getElementById('signalsTable').addEventListener('click', (e)=> {
                        const row=e.target.closest('tr');

                        if (row && row.dataset.symbol) {
                            showDetails(row.dataset.symbol);
                        }
                    });
            });

        // Toggle console visibility
        function toggleConsole() {
            const console=document.getElementById('activityConsole');
            const icon=document.getElementById('consoleToggleIcon');

            if (console.classList.contains('hidden')) {
                console.classList.remove('hidden');
                icon.textContent='‚ñ≤';
            }

            else {
                console.classList.add('hidden');
                icon.textContent='‚ñº';
            }
        }

        // Fetch activity logs
        async function fetchActivityLogs() {
            try {
                const response=await fetch('/api/auto/logs?limit=50');
                const data=await response.json();

                const consoleContent=document.getElementById('consoleContent');

                if ( !data.logs || data.logs.length===0) {
                    consoleContent.innerHTML='<div class="text-gray-400">No activity yet...</div>';
                    return;
                }

                consoleContent.innerHTML=data.logs.map(log=> {
                        const time=new Date(log.timestamp).toLocaleTimeString();
                        let colorClass='text-gray-300';
                        let icon='‚Ä¢';

                        switch (log.type) {
                            case 'success': colorClass='text-green-400';
                            icon='‚úì';
                            break;
                            case 'warning': colorClass='text-yellow-400';
                            icon='‚ö†';
                            break;
                            case 'error': colorClass='text-red-400';
                            icon='‚úó';
                            break;
                            case 'info': default: colorClass='text-blue-400';
                            icon='‚Ñπ';
                        }

                        return ` <div class="${colorClass} flex gap-2" > <span class="text-gray-500" >[$ {
                            time
                        }

                        ]</span> <span>$ {
                            icon
                        }

                        </span> <span>$ {
                            escapeHtml(log.message)
                        }

                        </span> </div> `;
                    }).join('');

            }

            catch (error) {
                console.error('Error fetching logs:', error);
            }
        }

        function escapeHtml(text) {
            const div=document.createElement('div');
            div.textContent=text;
            return div.innerHTML;
        }

        // Start refresh countdown
        function startRefreshCountdown() {
            clearInterval(countdownInterval);
            refreshCountdown=30;

            countdownInterval=setInterval(()=> {
                    refreshCountdown--;

                    document.getElementById('refreshTimer').textContent=`$ {
                        refreshCountdown
                    }

                    s`;

                    if (refreshCountdown <=0) {
                        refreshSignals();
                        refreshCountdown=30;
                    }
                }

                , 1000);
        }

        // Check scanner status
        async function checkScannerStatus() {
            try {
                const response=await fetch('/api/auto/status');
                const status=await response.json();

                const indicator=document.getElementById('statusIndicator');
                const details=document.getElementById('scannerDetails');

                if (status.isRunning) {
                    indicator.innerHTML='<span class="pulse-dot">‚óè</span> Scanner: Running';
                    indicator.className='text-sm font-normal px-3 py-1 rounded-full bg-green-900/30 text-green-400 border border-green-900/50 flex items-center gap-2';
                    details.classList.remove('hidden');

                    document.getElementById('scanInterval').textContent=`$ {
                        status.intervalMinutes
                    }

                    min`;
                    document.getElementById('watchlistCount').textContent=status.watchlistCount || 0;
                    document.getElementById('lastScan').textContent=status.lastScanTime ? new Date(status.lastScanTime).toLocaleTimeString() : 'Never';

                    // Calculate next scan
                    if (status.lastScanTime) {
                        const nextScanTime=new Date(new Date(status.lastScanTime).getTime() + status.intervalMinutes * 60000);
                        const now=new Date();
                        const minutesUntil=Math.max(0, Math.round((nextScanTime - now) / 60000));

                        document.getElementById('nextScan').textContent=`$ {
                            minutesUntil
                        }

                        min`;
                    }
                }

                else {
                    indicator.textContent='Scanner: Stopped';
                    indicator.className='text-sm font-normal px-3 py-1 rounded-full bg-gray-800 text-gray-400 border border-gray-700';
                    details.classList.add('hidden');
                }
            }

            catch (error) {
                console.error('Error checking status:', error);
            }
        }

        // Refresh signals
        async function refreshSignals() {
            try {
                const response=await fetch('/api/signals/live');
                const signals=await response.json();

                const tbody=document.getElementById('signalsTable');

                if ( !signals || signals.length===0) {
                    tbody.innerHTML=` <tr><td colspan="8" class="px-6 py-12 text-center text-gray-500"><div class="flex flex-col items-center gap-3"><svg class="w-16 h-16 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg><p class="text-lg font-medium text-gray-400">No signals yet</p><p class="text-sm text-gray-500">Start the scanner to begin analyzing your watchlist</p></div></td></tr>`;
                    return;
                }

                tbody.innerHTML=signals.map(signal=> {
                        const signalClass=`signal-$ {
                            signal.final_signal.replace(' ', '_')
                        }

                        `;
                        const timeAgo=getTimeAgo(signal.last_updated);

                        return ` <tr class="hover:bg-gray-800/50 transition border-b border-gray-800 last:border-0 group" data-symbol="${signal.symbol}" > <td class="px-4 py-3" > <div class="font-bold text-base text-gray-100" >$ {
                            signal.symbol
                        }

                        </div> </td> <td class="px-4 py-3" > <span class="${signalClass} text-white text-xs px-2 py-1 rounded font-bold uppercase tracking-wide" > $ {
                            signal.final_signal
                        }

                        </span> </td> <td class="px-4 py-3 text-center" > <div class="font-mono font-bold text-gray-200" >$ {
                            signal.final_score
                        }

                        %</div> </td> <td class="px-4 py-3 text-center" > <div class="flex justify-center gap-1.5" > $ {
                            renderTimeframeDot('15m', signal.signal_15m)
                        }

                        $ {
                            renderTimeframeDot('1H', signal.signal_1h)
                        }

                        $ {
                            renderTimeframeDot('1D', signal.signal_1d)
                        }

                        </div> </td> <td class="px-4 py-3 text-right font-mono text-gray-300" > $ {
                            signal.entry_price ? '$' + signal.entry_price.toFixed(2) : '-'
                        }

                        </td> <td class="px-4 py-3 text-right font-mono text-rose-400" > $ {
                            signal.stop_loss ? '$' + signal.stop_loss.toFixed(2) : '-'
                        }

                        </td> <td class="px-4 py-3 text-right font-mono text-emerald-400" > $ {
                            signal.target_price ? '$' + signal.target_price.toFixed(2) : '-'
                        }

                        </td> <td class="px-4 py-3 text-center text-xs text-gray-600 font-mono" > $ {
                            timeAgo
                        }

                        </td> <td class="px-4 py-3 text-center" > <div class="flex items-center justify-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity" > <button id="analyzeBtn-${signal.symbol}" onclick="analyzeSignal('${signal.symbol}')" class="p-1.5 bg-indigo-500/10 hover:bg-indigo-500/30 text-indigo-400 rounded border border-indigo-500/20 transition" title="AI Analysis" > ü§ñ </button> <button onclick="showDetails('${signal.symbol}')" class="p-1.5 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded border border-gray-600 transition" title="Details" > ‚ÑπÔ∏è </button> </div> </td> </tr> `;
                    }).join('');

                checkScannerStatus();

            }

            catch (error) {
                console.error('Error refreshing signals:', error);
            }
        }

        // Show signal details
        async function showDetails(symbol) {
            try {
                const response=await fetch(`/api/signals/live/$ {
                        symbol
                    }

                    `);
                const signal=await response.json();

                document.getElementById('modalSymbol').textContent=`$ {
                    symbol
                }

                - Detailed Breakdown`;

                document.getElementById('modalContent').innerHTML=` <div class="bg-gradient-to-r from-gray-800 to-gray-900 p-4 rounded-lg border border-gray-700"><div class="text-3xl font-bold text-center mb-2 text-white">$ {
                    signal.final_signal
                }

                </div><div class="text-5xl font-bold text-center text-blue-400">$ {
                    signal.final_score
                }

                %</div><p class="text-center text-gray-400 mt-2">Aggregated Confidence Score</p></div><div class="grid grid-cols-3 gap-4"><div class="bg-blue-900/20 border border-blue-900/30 p-4 rounded-lg text-center"><p class="text-sm text-gray-400 mb-1">Entry Price</p><p class="text-2xl font-bold text-blue-400">$ {
                    signal.entry_price ? '$'+signal.entry_price.toFixed(2): 'N/A'
                }

                </p></div><div class="bg-red-900/20 border border-red-900/30 p-4 rounded-lg text-center"><p class="text-sm text-gray-400 mb-1">Stop Loss</p><p class="text-2xl font-bold text-red-400">$ {
                    signal.stop_loss ? '$'+signal.stop_loss.toFixed(2): 'N/A'
                }

                </p></div><div class="bg-green-900/20 border border-green-900/30 p-4 rounded-lg text-center"><p class="text-sm text-gray-400 mb-1">Target</p><p class="text-2xl font-bold text-green-400">$ {
                    signal.target_price ? '$'+signal.target_price.toFixed(2): 'N/A'
                }

                </p></div></div><div><h3 class="font-semibold text-gray-300 mb-3">Timeframe Breakdown</h3><div class="space-y-3"><div class="border-l-4 ${getScoreColor(signal.score_15m)} bg-gray-800 p-4 rounded border-r border-t border-b border-gray-700"><div class="flex items-center justify-between mb-2"><span class="font-semibold text-gray-200">15-Minute</span><span class="timeframe-pill ${getScorePill(signal.score_15m)}">$ {
                    signal.score_15m
                }

                %</span></div><div class="text-sm text-gray-400"><strong class="text-gray-200">$ {
                    signal.signal_15m
                }

                </strong>- $ {
                    signal.top_strategy_15m
                }

                </div></div><div class="border-l-4 ${getScoreColor(signal.score_1h)} bg-gray-800 p-4 rounded border-r border-t border-b border-gray-700"><div class="flex items-center justify-between mb-2"><span class="font-semibold text-gray-200">1-Hour</span><span class="timeframe-pill ${getScorePill(signal.score_1h)}">$ {
                    signal.score_1h
                }

                %</span></div><div class="text-sm text-gray-400"><strong class="text-gray-200">$ {
                    signal.signal_1h
                }

                </strong>- $ {
                    signal.top_strategy_1h
                }

                </div></div><div class="border-l-4 ${getScoreColor(signal.score_1d)} bg-gray-800 p-4 rounded border-r border-t border-b border-gray-700"><div class="flex items-center justify-between mb-2"><span class="font-semibold text-gray-200">Daily</span><span class="timeframe-pill ${getScorePill(signal.score_1d)}">$ {
                    signal.score_1d
                }

                %</span></div><div class="text-sm text-gray-400"><strong class="text-gray-200">$ {
                    signal.signal_1d
                }

                </strong>- $ {
                    signal.top_strategy_1d
                }

                </div></div></div></div><div class="mt-4 pt-4 border-t border-gray-700"><h3 class="font-semibold text-gray-300 mb-2 flex items-center gap-2"><span class="text-indigo-400">ü§ñ Gemini AI Insight</span>$ {
                    signal.ai_analysis ? '': '<span class="text-xs text-gray-500 font-normal">(Not generated yet)</span>'
                }

                </h3><div class="bg-indigo-900/20 border border-indigo-500/30 p-4 rounded-lg text-sm text-gray-300 leading-relaxed">$ {
                    signal.ai_analysis ? renderAIContent(signal.ai_analysis):
                        `<button id="generateAiBtn" class="w-full py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded transition" >Generate AI Analysis</button>`
                }

                </div></div><div class="text-sm text-gray-500 text-center pt-4 border-t border-gray-700">Last scanned: $ {
                    new Date(signal.scan_timestamp).toLocaleString()
                }

                </div>`;

                // Attach event listener for AI button
                const aiBtn=document.getElementById('generateAiBtn');

                if (aiBtn) {
                    aiBtn.addEventListener('click', ()=> analyzeSignal(symbol));
                }

                document.getElementById('detailsModal').classList.remove('hidden');
                document.getElementById('detailsModal').classList.add('flex');

            }

            catch (error) {
                console.error('Error loading details:', error);
            }
        }

        function closeModal() {
            document.getElementById('detailsModal').classList.add('hidden');
            document.getElementById('detailsModal').classList.remove('flex');
        }

        // Helper functions
        function getTimeAgo(timestamp) {
            const now=new Date();
            const then=new Date(timestamp);
            const seconds=Math.floor((now - then) / 1000);

            if (seconds < 60) return 'Just now';
            const minutes=Math.floor(seconds / 60);

            if (minutes < 60) return `$ {
                minutes
            }

            m ago`;
            const hours=Math.floor(minutes / 60);

            if (hours < 24) return `$ {
                hours
            }

            h ago`;

            return `$ {
                Math.floor(hours / 24)
            }

            d ago`;
        }

        function renderTimeframeDot(label, signal) {
            let color='bg-gray-700';
            if (signal && (signal.includes('BUY') || signal==='BREAKOUT ALERT')) color='bg-green-500';
            else if (signal && (signal.includes('SELL') || signal==='BREAKDOWN')) color='bg-red-500';

            return ` <div class="flex flex-col items-center gap-1" title="${label}: ${signal}"><div class="w-3 h-3 rounded-full ${color}"></div><span class="text-[10px] text-gray-500">$ {
                label
            }

            </span></div>`;
        }

        async function fetchMarketStatus() {
            try {
                const res=await fetch('/api/scan/market/status');
                const data=await res.json();
                const ticker=document.getElementById('marketTicker');

                if (data.error) throw new Error(data.error);

                ticker.innerHTML=Object.entries(data).map(([symbol, quote])=> {
                        const color=quote.change >=0 ? 'text-green-400' : 'text-red-400';
                        const icon=quote.change >=0 ? '‚ñ≤' : '‚ñº';

                        return ` <div class="flex items-center gap-2 min-w-fit" > <span class="font-bold text-gray-300" >$ {
                            symbol
                        }

                        </span> <span class="${color}" >$ {
                            quote.price.toFixed(2)
                        }

                        </span> <span class="${color} text-xs" >($ {
                                icon
                            }

                            $ {
                                Math.abs(quote.change).toFixed(2)
                            }

                            %)</span> </div> `;
                    }).join('<div class="w-px h-4 bg-gray-800 mx-4"></div>');
            }

            catch (e) {
                console.error('Market status error:', e);
            }
        }

        window.analyzeSignal=async (symbol)=> {
            const btn=event.target;
            const originalText=btn.textContent;

            try {
                btn.disabled=true;
                btn.innerHTML='<span class="animate-pulse">Analyzing...</span>';

                const res=await fetch(`/api/signals/live/$ {
                        symbol
                    }

                    /analyze`, {
                    method: 'POST'
                });
            const data=await res.json();

            if (data.error) throw new Error(data.error);

            // Refresh details to show new analysis
            showDetails(symbol);

        }

        catch (e) {
            console.error('Analysis failed:', e);
            alert('Failed to generate analysis: ' + e.message);
            btn.textContent=originalText;
            btn.disabled=false;
        }
        }

        ;

        function renderAIContent(text) {
            // Simple markdown parsing
            return text .replace(/\*\*(.*?)\*\*/g, '<strong class="text-white">$1</strong>') .replace(/\n/g, '<br>');
        }

        function getScoreColor(score) {
            if (score >=70) return 'border-green-500';
            if (score >=40) return 'border-yellow-500';
            return 'border-gray-600';
        }

        function getScorePill(score) {
            if (score >=70) return 'tf-high';
            if (score >=40) return 'tf-medium';
            return 'tf-low';
        }

        // Scanner control functions
        async function manualScan() {
            const btn=document.getElementById('manualScanBtn');

            try {
                btn.disabled=true;
                btn.innerHTML='<span class="animate-spin inline-block">‚Üª</span> Scanning...';

                // Trigger the AutoTrader to run a single cycle
                const response=await fetch('/api/auto/cycle', {

                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
            const result=await response.json();

            console.log('Manual scan result:', result);

            // Refresh the signals table to show results
            setTimeout(refreshSignals, 1000);

            // Show success message
            const consoleContent=document.getElementById('consoleContent');
            const time=new Date().toLocaleTimeString();
            const logEntry=document.createElement('div');
            logEntry.className='text-green-400';

            logEntry.textContent=`[$ {
                time
            }

            ] ‚úì Manual scan completed successfully`;
            consoleContent.insertBefore(logEntry, consoleContent.firstChild);

        }

        catch (error) {
            console.error('Error running manual scan:', error);
            alert('Manual scan failed: ' + error.message);
        }

        finally {
            btn.disabled=false;
            btn.innerHTML='‚ö° Manual Scan';
        }
        }

        async function startScanner() {
            try {
                const response=await fetch('/api/auto/start', {

                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }

                    ,
                    body: JSON.stringify({
                        intervalMinutes: 15
                    })
            });
        const result=await response.json();
        alert(result.message);
        checkScannerStatus();
        setTimeout(refreshSignals, 2000); // Refresh after 2s to see first results
        }

        catch (error) {
            console.error('Error starting scanner:', error);
            alert('Failed to start scanner');
        }
        }

        async function stopScanner() {
            try {
                const response=await fetch('/api/auto/stop', {
                    method: 'POST'
                });
            const result=await response.json();
            alert(result.message);
            checkScannerStatus();
        }

        catch (error) {
            console.error('Error stopping scanner:', error);
            alert('Failed to stop scanner');
        }
        }

        // Close modal on outside click
        document.getElementById('detailsModal').addEventListener('click', (e)=> {
                if (e.target.id==='detailsModal') closeModal();
            });
        </script></body></html>