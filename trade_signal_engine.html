<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeSignal AI | Prescriptive Market Engine</title>
    <!-- Chosen Palette: Fintech Dark Mode (Background: Slate-900, Surface: Slate-800, Accents: Emerald-500 (Buy), Rose-500 (Sell), Indigo-500 (Action)) -->
    
    <!-- Application Structure Plan:
        1. Header: Global Market Sentiment (VIX context).
        2. Control Center: "Run Scan" button and active asset selector.
        3. The "Signal Stream": A dynamic list of strategies (Pullback, Momentum, Squeeze). Unlike a standard dashboard, these are "State Cards" that change from "Scanning..." to "Signal Found" or "No Signal".
        4. "The Evidence" (Main Interaction): Clicking a signal card populates the main view.
            - Top: Strategy Score & Recommendation.
            - Middle: Interactive Chart visualizing the specific indicator logic (e.g., drawing the Bollinger Bands).
            - Bottom: The "Why" Checklist (Condition 1, Condition 2, Condition 3) and Educational Context.
    -->

    <!-- Visualization & Content Choices:
        - Strategy Cards: Goal: Summarize opportunity. Viz: Card with progress bar/score. Interaction: Click to load details.
        - Main Chart: Goal: Visual Proof. Viz: Chart.js Combo Chart (Candlesticks + Line for SMA/Bollinger). Interaction: Dynamic updates based on selected strategy.
        - Confluence Checklist: Goal: Validation. Viz: List with check/x icons. Interaction: None (informational).
        - Gauge/Score: Goal: Immediate impact. Viz: Doughnut chart or CSS bar.
    -->
    
    <!-- CONFIRMATION: NO SVG graphics used (using Unicode/CSS). NO Mermaid JS used. -->

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Luxon for time handling in charts -->
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Custom Scrollbar for "Data Heavy" feel */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        .chart-container {
            position: relative;
            width: 100%;
            height: 400px;
            max-height: 500px;
        }

        /* Animations */
        @keyframes pulse-glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        .animate-pulse-slow { animation: pulse-glow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        
        .loading-bar {
            height: 4px;
            background: linear-gradient(90deg, transparent, #6366f1, transparent);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 100% 0; }
            100% { background-position: -100% 0; }
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-200 min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="border-b border-slate-700 bg-slate-900/95 sticky top-0 z-50 backdrop-blur-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-indigo-600 rounded flex items-center justify-center font-bold text-white">TS</div>
                    <span class="font-bold text-xl tracking-tight text-white">TradeSignal<span class="text-indigo-400">AI</span></span>
                </div>
                <div class="flex items-center gap-6 text-sm">
                    <div class="hidden md:flex items-center gap-2">
                        <span class="text-slate-400">Market Regime:</span>
                        <span class="px-2 py-1 rounded bg-emerald-500/10 text-emerald-400 font-medium border border-emerald-500/20">Bullish Trend</span>
                    </div>
                    <div class="hidden md:flex items-center gap-2">
                        <span class="text-slate-400">VIX:</span>
                        <span class="font-mono text-amber-400">18.42 (Elevated)</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>
                <div class="text-center text-slate-500 py-10 italic">
                    Select an asset and run the scan to identify high-probability setups.
                </div>
            </div>

            <!-- Educational Context (Sticky) -->
            <div class="bg-slate-800/50 rounded-xl border border-slate-700/50 p-5 mt-auto">
                <h4 class="text-indigo-400 font-medium text-sm mb-2">Using This Tool</h4>
                <p class="text-xs text-slate-400 leading-relaxed">
                    This engine uses <strong>Confluence Scoring</strong>. We don't trust single indicators. A score > 80% means trend, momentum, and volatility indicators all agree, drastically increasing probability.
                </p>
            </div>
        </aside>

        <!-- RIGHT PANEL: Deep Analysis (The "Why") -->
        <section class="lg:col-span-8 flex flex-col gap-6">
            
            <!-- Hero Analysis Card (Hidden initially) -->
            <div id="analysisPanel" class="hidden flex-col gap-6 h-full">
                
                <!-- Header -->
                <header class="bg-slate-800 rounded-xl border border-slate-700 p-6 shadow-lg relative overflow-hidden">
                    <div class="relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <div>
                            <div class="flex items-center gap-3 mb-1">
                                <span id="detailBadge" class="px-2 py-0.5 rounded text-xs font-bold bg-emerald-500 text-slate-900 uppercase tracking-wide">STRONG BUY</span>
                                <span id="detailAsset" class="text-slate-400 font-mono text-sm">SPY</span>
                            </div>
                            <h2 id="detailTitle" class="text-2xl font-bold text-white">Momentum Surfer Strategy</h2>
                            <p id="detailDesc" class="text-slate-400 text-sm mt-1">Trend following system capturing high-volume breakouts.</p>
                        </div>
                        
                        <!-- Confidence Score -->
                        <div class="flex items-center gap-4 bg-slate-900/50 p-3 rounded-lg border border-slate-700">
                            <div class="text-right">
                                <div class="text-xs text-slate-500 uppercase font-bold">Confidence</div>
                                <div id="detailScore" class="text-2xl font-bold text-emerald-400">85%</div>
                            </div>
                            <div class="w-12 h-12 relative">
                                <svg class="w-full h-full transform -rotate-90">
                                    <circle cx="24" cy="24" r="20" stroke="#1e293b" stroke-width="4" fill="none" />
                                    <circle id="scoreCircle" cx="24" cy="24" r="20" stroke="#10b981" stroke-width="4" fill="none" stroke-dasharray="125.6" stroke-dashoffset="20" class="transition-all duration-1000 ease-out" />
                                </svg>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Main Chart Area -->
                <div class="bg-slate-800 rounded-xl border border-slate-700 p-4 shadow-lg flex-grow flex flex-col">
                    <div class="flex justify-between items-center mb-4 px-2">
                        <h3 class="text-white font-semibold text-sm">Visual Confirmation</h3>
                        <div class="flex gap-2">
                            <span class="text-xs text-slate-500 flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-blue-500"></span> Price</span>
                            <span class="text-xs text-slate-500 flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-purple-500"></span> Indicator</span>
                        </div>
                    </div>
                    <div class="chart-container w-full h-full bg-slate-900/50 rounded-lg border border-slate-700/50">
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>

                <!-- The "Why" Logic Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <!-- Checklist -->
                    <div class="bg-slate-800 rounded-xl border border-slate-700 p-5 shadow-lg">
                        <h3 class="text-white font-semibold mb-4 border-b border-slate-700 pb-2">Confluence Checklist</h3>
                        <ul id="checklistContainer" class="space-y-3">
                            <!-- Items injected via JS -->
                        </ul>
                    </div>

                    <!-- Logic Explainer -->
                    <div class="bg-slate-800 rounded-xl border border-slate-700 p-5 shadow-lg">
                        <h3 class="text-white font-semibold mb-4 border-b border-slate-700 pb-2">Strategy Logic</h3>
                        <div id="logicContainer" class="space-y-3 text-sm text-slate-300">
                            <!-- Text injected via JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="h-full flex flex-col items-center justify-center text-slate-600 p-10 border-2 border-dashed border-slate-800 rounded-xl">
                <div class="text-6xl mb-4 opacity-20">üìä</div>
                <h3 class="text-xl font-semibold text-slate-500">Awaiting Scan Results</h3>
                <p class="text-sm max-w-md text-center mt-2">Select an asset and run the scanner to analyze technical indicators across multiple strategies.</p>
            </div>

        </section>
    </main>

    <script>
        // --- Configuration & Data Simulation ---

        const strategies = [
            {
                id: 'pullback',
                name: 'Pullback Sniper',
                type: 'Mean Reversion',
                desc: 'Identifies oversold dips within a primary uptrend.',
                triggers: [
                    { name: 'Primary Trend', desc: 'Price is above the 200-day SMA.', met: true },
                    { name: 'RSI Oversold', desc: 'RSI (14) has dropped below 35.', met: true },
                    { name: 'VIX Spike', desc: 'Volatility index showing short-term fear.', met: true },
                    { name: 'Support Zone', desc: 'Price touching Lower Bollinger Band.', met: true }
                ],
                score: 92,
                signal: 'STRONG BUY',
                color: 'emerald',
                education: 'This strategy works best in Bull Markets. We are buying fear (low RSI) when the long-term trend (200 SMA) is still positive. It bets on the price snapping back to the mean.'
            },
            {
                id: 'momentum',
                name: 'Momentum Surfer',
                type: 'Trend Following',
                desc: 'Captures acceleration in price with volume confirmation.',
                triggers: [
                    { name: 'MACD Crossover', desc: 'MACD line crossed above Signal line.', met: true },
                    { name: 'Volume Spike', desc: 'Volume is > 120% of 10-day average.', met: false }, // Simulation: failing condition
                    { name: 'Breakout', desc: 'Price closed above 50-day SMA.', met: true }
                ],
                score: 65,
                signal: 'WATCH',
                color: 'amber',
                education: 'Momentum trading requires volume. While the price is moving up and MACD is bullish, the lack of Volume confirmation suggests this might be a "fake out". Wait for volume.'
            },
            {
                id: 'squeeze',
                name: 'Volatility Squeeze',
                type: 'Breakout',
                desc: 'Detects periods of low volatility before explosive moves.',
                triggers: [
                    { name: 'Band Width', desc: 'Bollinger Bands are at 6-month narrowest.', met: false },
                    { name: 'ADX Strength', desc: 'ADX is below 20 (Trend is sleeping).', met: true },
                    { name: 'Price Coiling', desc: 'Price stuck in tight range.', met: false }
                ],
                score: 30,
                signal: 'NO SIGNAL',
                color: 'slate',
                education: 'Markets alternate between expansion and contraction. A squeeze happens when volatility dies down. We are waiting for the bands to "pinch" before entering.'
            }
        ];

        // --- Chart Data Generators (Simulation) ---

        function generateDates(count) {
            const dates = [];
            let today = new Date();
            for (let i = count; i > 0; i--) {
                const d = new Date(today);
                d.setDate(d.getDate() - i);
                dates.push(d.toISOString().split('T')[0]);
            }
            return dates;
        }

        function generatePriceData(startPrice, count, trend = 'up') {
            let price = startPrice;
            const data = [];
            for (let i = 0; i < count; i++) {
                let change = (Math.random() - 0.45) * 2; // Slight upward bias
                if (trend === 'down') change = (Math.random() - 0.55) * 2;
                
                // Create a dip at the end for "Pullback" simulation
                if (i > count - 5) change -= 1.5; 

                price += change;
                data.push(price);
            }
            return data;
        }

        // SMA Calculation
        function calculateSMA(data, window) {
            let sma = [];
            for (let i = 0; i < data.length; i++) {
                if (i < window - 1) {
                    sma.push(null);
                    continue;
                }
                const slice = data.slice(i - window + 1, i + 1);
                const sum = slice.reduce((a, b) => a + b, 0);
                sma.push(sum / window);
            }
            return sma;
        }

        // Mock Indicator Data
        function generateBollinger(smaData, factor) {
            return smaData.map(val => val ? val + factor : null);
        }

        // --- UI Interaction Logic ---

        let mainChart = null;

        document.getElementById('scanBtn').addEventListener('click', runScan);

        function runScan() {
            const btn = document.getElementById('scanBtn');
            const list = document.getElementById('strategyList');
            const empty = document.getElementById('emptyState');
            const panel = document.getElementById('analysisPanel');

            // Reset UI
            list.innerHTML = '';
            empty.classList.remove('hidden');
            panel.classList.add('hidden');
            
            // Loading State
            btn.disabled = true;
            btn.innerHTML = `<span class="animate-spin">‚Üª</span> Scanning Markets...`;
            btn.classList.add('bg-slate-700');

            // Simulate API Delay and Staggered Results
            strategies.forEach((strategy, index) => {
                setTimeout(() => {
                    const card = createStrategyCard(strategy);
                    list.appendChild(card);
                    
                    // Auto-select the first high-score strategy
                    if (index === 0) {
                        simulateClick(card);
                    }
                }, (index + 1) * 600); // Stagger card appearance
            });

            setTimeout(() => {
                btn.disabled = false;
                btn.innerHTML = `<span id="scanIcon">üîç</span> <span id="scanText">Run Alpha Scan</span>`;
                btn.classList.remove('bg-slate-700');
            }, 2000);
        }

        function createStrategyCard(strategy) {
            const div = document.createElement('div');
            div.className = `bg-slate-800 border border-slate-700 p-4 rounded-lg cursor-pointer hover:border-indigo-500 transition-all transform hover:-translate-y-1 group relative overflow-hidden`;
            div.onclick = () => loadStrategyDetails(strategy);

            // Color Logic
            let scoreColor = 'text-slate-400';
            if (strategy.score >= 80) scoreColor = 'text-emerald-400';
            else if (strategy.score >= 50) scoreColor = 'text-amber-400';

            div.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <div>
                        <h3 class="text-white font-semibold group-hover:text-indigo-400 transition-colors">${strategy.name}</h3>
                        <span class="text-xs text-slate-500 uppercase tracking-wider">${strategy.type}</span>
                    </div>
                    <div class="text-right">
                        <span class="block text-xl font-bold ${scoreColor}">${strategy.score}%</span>
                    </div>
                </div>
                <div class="w-full bg-slate-700 h-1.5 rounded-full overflow-hidden mt-2">
                    <div class="h-full bg-${strategy.color}-500" style="width: ${strategy.score}%"></div>
                </div>
                <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs font-mono px-2 py-1 rounded bg-${strategy.color}-500/10 text-${strategy.color}-400 border border-${strategy.color}-500/20">
                        ${strategy.signal}
                    </span>
                    <span class="text-xs text-indigo-400 opacity-0 group-hover:opacity-100 transition-opacity">View Analysis ‚Üí</span>
                </div>
            `;
            return div;
        }

        function simulateClick(element) {
            element.click();
            // Add active state visual
            const cards = document.querySelectorAll('#strategyList > div');
            cards.forEach(c => c.classList.remove('ring-2', 'ring-indigo-500'));
            element.classList.add('ring-2', 'ring-indigo-500');
        }

        function loadStrategyDetails(strategy) {
            // Hide Empty, Show Panel
            document.getElementById('emptyState').classList.add('hidden');
            const panel = document.getElementById('analysisPanel');
            panel.classList.remove('hidden');
            panel.classList.add('animate-pulse-quick'); // subtle flash

            // Populate Header
            document.getElementById('detailTitle').textContent = strategy.name;
            document.getElementById('detailDesc').textContent = strategy.desc;
            document.getElementById('detailAsset').textContent = document.getElementById('assetSelect').value;
            
            const badge = document.getElementById('detailBadge');
            badge.textContent = strategy.signal;
            badge.className = `px-2 py-0.5 rounded text-xs font-bold uppercase tracking-wide bg-${strategy.color}-500 text-slate-900`;

            // Score Animation
            const scoreEl = document.getElementById('detailScore');
            scoreEl.className = `text-2xl font-bold text-${strategy.color}-400`;
            animateValue(scoreEl, 0, strategy.score, 800);
            
            const circle = document.getElementById('scoreCircle');
            circle.setAttribute('stroke', strategy.color === 'emerald' ? '#10b981' : (strategy.color === 'amber' ? '#fbbf24' : '#64748b'));
            const offset = 125.6 - (125.6 * (strategy.score / 100));
            circle.style.strokeDashoffset = offset;

            // Populate Checklist
            const checkList = document.getElementById('checklistContainer');
            checkList.innerHTML = '';
            strategy.triggers.forEach(trigger => {
                const li = document.createElement('li');
                li.className = 'flex items-start gap-3';
                const icon = trigger.met ? '‚úÖ' : '‚ùå';
                const color = trigger.met ? 'text-emerald-400' : 'text-rose-400';
                li.innerHTML = `
                    <span class="mt-0.5 text-sm">${icon}</span>
                    <div>
                        <span class="block text-sm font-medium text-slate-200">${trigger.name}</span>
                        <span class="block text-xs text-slate-500">${trigger.desc}</span>
                    </div>
                `;
                checkList.appendChild(li);
            });

            // Populate Logic/Education
            const logicDiv = document.getElementById('logicContainer');
            logicDiv.innerHTML = `
                <p class="leading-relaxed mb-3">${strategy.education}</p>
                <div class="bg-indigo-900/20 border border-indigo-500/30 p-3 rounded text-xs text-indigo-300">
                    <strong>üí° Pro Tip:</strong> Always verify this technical signal with upcoming earnings dates and macro-economic news.
                </div>
            `;

            // Render Chart
            renderChart(strategy);
        }

        function animateValue(obj, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Math.floor(progress * (end - start) + start) + '%';
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        // --- Chart.js Implementation ---

        function renderChart(strategy) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            
            if (mainChart) mainChart.destroy();

            // Generate Data based on strategy type for visual relevance
            const dates = generateDates(50);
            let prices = generatePriceData(420, 50);
            
            // Modify data shape to match the "story" of the strategy
            if (strategy.id === 'pullback') {
                // Make price drop at end
                prices = prices.map((p, i) => i > 40 ? p * 0.97 : p); 
            } else if (strategy.id === 'momentum') {
                // Make price spike at end
                prices = prices.map((p, i) => i > 40 ? p * 1.03 : p);
            }

            const sma = calculateSMA(prices, 20);
            const upperBand = generateBollinger(sma, 5);
            const lowerBand = generateBollinger(sma, -5);

            // Configure datasets based on strategy
            let datasets = [
                {
                    type: 'line',
                    label: 'Price',
                    data: prices,
                    borderColor: '#6366f1',
                    backgroundColor: 'rgba(99, 102, 241, 0.1)',
                    borderWidth: 2,
                    tension: 0.3,
                    pointRadius: 0,
                    yAxisID: 'y'
                }
            ];

            // Add context lines based on strategy
            if (strategy.id === 'pullback' || strategy.id === 'squeeze') {
                datasets.push({
                    type: 'line',
                    label: 'Upper Band',
                    data: upperBand,
                    borderColor: 'rgba(255, 255, 255, 0.2)',
                    borderDash: [5, 5],
                    borderWidth: 1,
                    pointRadius: 0,
                    fill: false
                });
                datasets.push({
                    type: 'line',
                    label: 'Lower Band',
                    data: lowerBand,
                    borderColor: 'rgba(16, 185, 129, 0.5)', // Green support line
                    borderWidth: 1,
                    pointRadius: 0,
                    fill: false
                });
                datasets.push({
                    type: 'line',
                    label: '20 SMA',
                    data: sma,
                    borderColor: '#f59e0b',
                    borderWidth: 1,
                    pointRadius: 0
                });
            }

            mainChart = new Chart(ctx, {
                data: {
                    labels: dates,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: { display: true, labels: { color: '#94a3b8' } },
                        tooltip: {
                            backgroundColor: '#1e293b',
                            titleColor: '#fff',
                            bodyColor: '#cbd5e1',
                            borderColor: '#334155',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: '#334155', drawBorder: false },
                            ticks: { color: '#64748b', maxTicksLimit: 8 }
                        },
                        y: {
                            grid: { color: '#334155', drawBorder: false },
                            ticks: { color: '#64748b' }
                        }
                    }
                }
            });
        }

    </script>
</body>
</html>